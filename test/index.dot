<html>
<head>
  <meta charset="utf-8">
  <title>NetsBlox Client Tests</title>
  <link href="lib/mocha.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/css/materialize.min.css">
  <link href="lib/material-icons.css" rel="stylesheet">
</head>
<body style="margin: 0;">
  <canvas id="world" tabindex="1" style="position: absolute;" ></canvas>
  <!-- Add the testing things -->
  <div id="tests-modal" class="modal">
      <div class="model-content">
          <div id="mocha"></div>
      </div>
  </div>
  <a class="btn-floating btn-large waves-effect waves-light red modal-trigger" href="#tests-modal" style="position: absolute; bottom: 24px; right: 24px;"><i class="material-icons">check</i></a>

  <script src="lib/jquery-2.2.4.min.js"></script>
  <script src="lib/expect.min.js"></script>
  <script src="lib/mocha.js"></script>
  <script>mocha.setup('bdd')</script>

  <!-- Set up NetsBlox -->
  <script type="text/javascript" >
      var SERVER_URL = window.location.origin,
          SERVER_ADDRESS = SERVER_URL.replace(/^.*\/\//, '');

      /* Uncomment the following to add a console log at the start of each test
        var oit = it;
        it = function(desc, test) {
            if (test.length) {
                return oit.call(this, desc, function(done) {
                    console.log('starting test:', desc);
                    return test(done);
                });
            } else {
                return oit.call(this, desc, function() {
                    console.log('starting test:', desc);
                    return test();
                });
            }
        };
      */
  </script>
  <script type="text/javascript" src="/dist/app.min.js"></script>
  <script src="./snap-driver.js"></script>
  <script src="./replay.spec.js"></script>
  <script src="./test-utils.js"></script>
  <script src="./room.spec.js"></script>
  <script src="./save.spec.js"></script>
  <script src="./messages.spec.js"></script>
  <script src="./blocks.spec.js"></script>
  <script src="./actions.spec.js"></script>
  <script src="./accounts.spec.js"></script>
  <script src="./ide.spec.js"></script>
  <script src="./variables.spec.js"></script>
  <script src="./sprites.spec.js"></script>
  <script src="./xml.spec.js"></script>
  <script type="text/javascript">
    {{ if (it.username) { }}
        SnapCloud.username = '{{= it.username }}';
        SnapCloud.password = true;
    {{ } }}
      var world;
      var driver;
      window.onload = function () {
          world = new WorldMorph(document.getElementById('world'));
          world.worldCanvas.focus();
          new NetsBloxMorph().openIn(world);
          loop();

          /* start the tests */
          driver = new SnapDriver(world);
          /* create test user if needed */
          mocha.run();
      };
      function loop() {
          requestAnimationFrame(loop);
          world.doOneCycle();
      }
  </script>
  <script src="lib/materialize.min.js"></script>

  <script>
    $(document).ready(function(){
      $('.modal').modal();
      $('.modal').modal('open');
    });
  </script>
</body>
</html>
